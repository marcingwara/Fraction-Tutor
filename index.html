<!doctype html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <title>Fraction Tutor ‚Äî Kalkulator u≈Çamk√≥w z wizualizacjƒÖ</title>
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --border: rgba(255,255,255,.14);
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --accent: #7c5cff;
      --accent2:#38bdf8;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    [data-theme="light"]{
      --bg:#f6f7fb;
      --panel: rgba(15,23,42,.06);
      --panel2: rgba(15,23,42,.09);
      --text: rgba(2,6,23,.92);
      --muted: rgba(2,6,23,.62);
      --border: rgba(2,6,23,.14);
      --shadow: 0 18px 55px rgba(2,6,23,.12);
      --accent:#6d28d9;
      --accent2:#0284c7;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1100px 700px at 20% 10%, rgba(124,92,255,.35), transparent 60%),
        radial-gradient(900px 600px at 80% 25%, rgba(56,189,248,.25), transparent 60%),
        radial-gradient(900px 600px at 40% 95%, rgba(34,197,94,.15), transparent 60%),
        var(--bg);
      min-height:100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 28px 16px 42px;
    }

    header{
      display:flex;
      gap:16px;
      align-items:flex-start;
      justify-content:space-between;
      margin-bottom: 18px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .author-name{
      font-weight: 800;
      font-size: 28px;
      letter-spacing: 1.5px;
      background: linear-gradient(135deg, #7c5cff, #38bdf8, #22c55e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
    }
    
    /* Fix for Safari/iOS */
    @supports (-webkit-background-clip: text) {
      .author-name {
        background: linear-gradient(135deg, #7c5cff, #38bdf8, #22c55e);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 8px 12px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, var(--panel), transparent);
      border-radius: 999px;
      width: fit-content;
      box-shadow: var(--shadow);
    }

    .dot{
      width:10px;height:10px;border-radius:99px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 6px rgba(124,92,255,.12);
    }

    h1{
      margin: 6px 0 0;
      font-size: clamp(22px, 3.2vw, 34px);
      letter-spacing: .2px;
      line-height:1.15;
    }

    .sub{
      color: var(--muted);
      max-width: 64ch;
      line-height:1.45;
      margin: 0;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top: 6px;
    }

    .pill{
      display:flex;
      gap:8px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, var(--panel2), transparent);
      box-shadow: var(--shadow);
    }

    select, button, input{
      font: inherit;
      color: var(--text);
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    select{ 
      padding-right: 34px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
    }
    input::placeholder{ color: rgba(255,255,255,.45); }
    [data-theme="light"] input::placeholder{ color: rgba(2,6,23,.45); }

    button{
      cursor:pointer;
      border:1px solid rgba(124,92,255,.35);
      background: linear-gradient(135deg, rgba(124,92,255,.35), rgba(56,189,248,.20));
      transition: transform .06s ease, filter .15s ease;
      font-weight: 650;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    button:hover{ filter: brightness(1.07); }
    button:active{ transform: translateY(1px); }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 14px;
    }

    @media (max-width: 980px){
      header{ flex-direction:column; }
      .controls{ justify-content:flex-start; }
    }

    .card{
      border:1px solid var(--border);
      background: linear-gradient(180deg, var(--panel2), transparent);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .card .hd{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.08), transparent);
    }
    .card .hd h2{
      margin:0;
      font-size: 15px;
      letter-spacing:.2px;
    }
    .card .bd{
      padding: 14px 16px 16px;
    }

    .form{
      display:grid;
      grid-template-columns: 1fr 110px 1fr;
      gap: 10px;
      align-items:end;
    }
    @media (max-width: 680px){
      .form{
        grid-template-columns: 1fr;
        gap: 12px;
      }
    }
    
    /* iOS Safari fix */
    @supports (-webkit-overflow-scrolling: touch) {
      .form {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        flex-wrap: wrap;
      }
      .form > div {
        flex: 1 1 auto;
        min-width: 110px;
      }
      @media (max-width: 680px){
        .form {
          -webkit-box-orient: vertical;
          -webkit-box-direction: normal;
          -ms-flex-direction: column;
          flex-direction: column;
        }
        .form > div {
          width: 100%;
        }
      }
    }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      letter-spacing:.2px;
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
      line-height: 1.35;
    }

    .resultRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    @media (max-width: 680px){
      .resultRow{ grid-template-columns: 1fr; }
    }

    .resultBox{
      border: 1px dashed rgba(255,255,255,.22);
      border-radius: 14px;
      padding: 12px 12px;
      background: rgba(0,0,0,.14);
    }
    [data-theme="light"] .resultBox{ background: rgba(2,6,23,.04); border-color: rgba(2,6,23,.22); }

    .resultBox .k{
      font-size:12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .resultBox .v{
      font-family: var(--mono);
      font-size: 18px;
      font-weight: 800;
      letter-spacing:.3px;
    }

    .steps{
      font-family: var(--mono);
      white-space: pre-wrap;
      line-height: 1.45;
      font-size: 13px;
      padding: 14px;
      border-top: 1px solid var(--border);
      background: rgba(0,0,0,.10);
      min-height: 200px;
    }
    [data-theme="light"] .steps{ background: rgba(2,6,23,.03); }

    .visual-section{
      margin-top: 16px;
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: rgba(0,0,0,.08);
    }
    [data-theme="light"] .visual-section{ background: rgba(2,6,23,.02); }

    .visual-title{
      font-size: 13px;
      font-weight: 700;
      color: var(--accent2);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .visual-step{
      margin: 16px 0;
      padding: 14px;
      background: rgba(124,92,255,.08);
      border-radius: 12px;
      border-left: 4px solid var(--accent);
    }

    .visual-step-title{
      font-size: 14px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .visual-step-title .step-number{
      background: var(--accent);
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 800;
    }

    .visual-step-content{
      font-size: 13px;
      line-height: 1.5;
      color: var(--muted);
    }

    .fraction-comparison{
      display: flex;
      gap: 12px;
      align-items: center;
      margin: 12px 0;
      flex-wrap: wrap;
      padding: 12px;
      background: rgba(0,0,0,.15);
      border-radius: 10px;
    }

    [data-theme="light"] .fraction-comparison{
      background: rgba(2,6,23,.05);
    }

    .arrow{
      font-size: 24px;
      color: var(--accent2);
      font-weight: 700;
    }

    .lcm-box{
      display: inline-block;
      padding: 6px 12px;
      background: linear-gradient(135deg, rgba(124,92,255,.25), rgba(56,189,248,.15));
      border-radius: 8px;
      font-family: var(--mono);
      font-weight: 700;
      color: var(--accent2);
      margin: 4px;
    }

    .multiplier-visual{
      display: flex;
      gap: 8px;
      align-items: center;
      margin: 8px 0;
      font-family: var(--mono);
      font-size: 14px;
    }

    .multiplier-box{
      padding: 4px 10px;
      background: rgba(34,197,94,.15);
      border: 1px solid var(--good);
      border-radius: 6px;
      color: var(--good);
      font-weight: 700;
    }

    .explanation-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin: 12px 0;
    }

    .explanation-card{
      padding: 12px;
      background: rgba(0,0,0,.12);
      border-radius: 10px;
      border: 1px solid var(--border);
    }

    [data-theme="light"] .explanation-card{
      background: rgba(2,6,23,.04);
    }

    .explanation-card-title{
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .explanation-card-value{
      font-family: var(--mono);
      font-size: 16px;
      font-weight: 700;
      color: var(--text);
    }

    .fraction-visual{
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
      margin: 12px 0;
    }

    .fraction-box{
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .fraction-display{
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: var(--mono);
      font-size: 24px;
      font-weight: 700;
      min-width: 60px;
    }

    .numerator{
      padding: 4px 8px;
      color: var(--accent2);
    }

    .fraction-line{
      width: 100%;
      height: 2px;
      background: var(--text);
      margin: 2px 0;
    }

    .denominator{
      padding: 4px 8px;
      color: var(--good);
    }

    .operator{
      font-size: 28px;
      font-weight: 700;
      color: var(--warn);
    }

    .pie-container{
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .pie-wrapper{
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .pie-label{
      font-size: 11px;
      color: var(--muted);
      font-weight: 600;
    }

    canvas{
      border-radius: 8px;
      background: rgba(255,255,255,.03);
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
    }

    [data-theme="light"] canvas{
      background: rgba(2,6,23,.02);
    }

    .toast{
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(239,68,68,.35);
      background: rgba(239,68,68,.12);
      color: var(--text);
      display:none;
      margin-top: 10px;
    }

    .mini{
      font-size: 12px;
      color: var(--muted);
      margin: 0;
    }

    footer{
      margin-top: 14px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
    }

    .kbd{
      font-family: var(--mono);
      border:1px solid var(--border);
      padding: 2px 8px;
      border-radius: 10px;
      background: rgba(0,0,0,.12);
    }
    [data-theme="light"] .kbd{ background: rgba(2,6,23,.04); }

    .help-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
      margin-top: 14px;
    }

    .help-card{
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: rgba(0,0,0,.08);
    }

    [data-theme="light"] .help-card{
      background: rgba(2,6,23,.02);
    }

    .help-card h3{
      margin: 0 0 8px 0;
      font-size: 14px;
      color: var(--accent);
    }

    .help-card p{
      margin: 0;
      font-size: 12px;
      line-height: 1.4;
      color: var(--muted);
    }

    .step-visual{
      margin: 8px 0;
      padding: 8px;
      background: rgba(124,92,255,.08);
      border-radius: 8px;
      border-left: 3px solid var(--accent);
    }
  </style>
</head>

<body data-theme="dark">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="author-name">Marcin Gwara</div>
        
        <div class="badge">
          <div class="dot"></div>
          <div style="font-weight:700">Fraction Tutor</div>
          <div style="opacity:.55">‚Äî wizualizacja krok po kroku</div>
        </div>
        <h1 id="title">Kalkulator u≈Çamk√≥w z grafikƒÖ</h1>
        <p class="sub" id="subtitle">
          Zobacz jak dzia≈ÇajƒÖ u≈Çamki dziƒôki kolorowym wizualizacjom i szczeg√≥≈Çowym wyja≈õnieniom ka≈ºdego kroku.
        </p>
      </div>

      <div class="controls">
        <div class="pill">
          <span id="langLabel" class="mini">Jƒôzyk</span>
          <select id="langSelect" aria-label="Language">
            <option value="PL">PL</option>
            <option value="EN">EN</option>
            <option value="DE">DE</option>
            <option value="TR">TR</option>
            <option value="RU">RU</option>
          </select>
        </div>
        <button id="themeBtn" type="button">üåô / ‚òÄÔ∏è</button>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="hd">
          <h2 id="calcHeader">Obliczenia</h2>
          <p class="mini" id="examples">Przyk≈Çady: <span class="kbd">2 1/3</span>, <span class="kbd">3/4</span>, <span class="kbd">5</span></p>
        </div>
        <div class="bd">
          <div class="form">
            <div>
              <label id="aLabel" for="aInput">Liczba A</label>
              <input id="aInput" placeholder="np. 2 1/3" />
            </div>

            <div>
              <label id="opLabel" for="opSelect">Dzia≈Çanie</label>
              <select id="opSelect">
                <option value="+">+</option>
                <option value="-">‚àí</option>
                <option value="*">√ó</option>
                <option value="/">√∑</option>
              </select>
            </div>

            <div>
              <label id="bLabel" for="bInput">Liczba B</label>
              <input id="bInput" placeholder="np. 1/6" />
            </div>
          </div>

          <div style="display:flex; gap:10px; margin-top: 12px; flex-wrap:wrap;">
            <button id="calcBtn" type="button">Policz i wyt≈Çumacz</button>
            <button id="fillBtn" type="button" style="border-color: rgba(34,197,94,.35); background: linear-gradient(135deg, rgba(34,197,94,.22), rgba(56,189,248,.10)); font-weight:650;">
              Wstaw przyk≈Çad
            </button>
          </div>

          <div class="toast" id="toast"></div>

          <p class="hint" id="hint">
            Liczba mieszana wpisuj jako <span class="kbd">2 1/3</span> (jedna spacja). U≈Çamki jako <span class="kbd">a/b</span>.
          </p>

          <div class="resultRow">
            <div class="resultBox">
              <div class="k" id="resFracLabel">Wynik jako u≈Çamek</div>
              <div class="v" id="resFrac">‚Äî</div>
            </div>
            <div class="resultBox">
              <div class="k" id="resMixLabel">Wynik jako mieszana</div>
              <div class="v" id="resMix">‚Äî</div>
            </div>
          </div>

          <div class="visual-section" id="visualSection" style="display:none;">
            <div class="visual-title">üìä Wizualizacja dzia≈Çania</div>
            <div id="visualExplanation"></div>
            <div id="fractionVisual"></div>
            <div id="pieVisual"></div>
          </div>
        </div>

        <div class="steps" id="steps">
Tu pojawi siƒô dok≈Çadne wyja≈õnienie krok po kroku z grafikƒÖ.
        </div>
      </section>

      <aside class="card">
        <div class="hd">
          <h2 id="helpHeader">Jak dzia≈ÇajƒÖ u≈Çamki?</h2>
          <p class="mini" id="helpMini">Ilustrowany przewodnik</p>
        </div>
        <div class="bd" id="helpBody">
          <div class="help-grid" id="helpCards"></div>

          <hr style="border:0;border-top:1px solid var(--border);margin:16px 0"/>
          <p class="mini" id="helpTip"></p>
        </div>
      </aside>
    </div>

    <footer>
      <div>Projekt edukacyjny ¬© 2024</div>
      <div>Wersja: <span class="kbd">v2.0 - Visual</span></div>
    </footer>
  </div>

<script>
  // Check BigInt support (required for iOS 14+)
  if (typeof BigInt === 'undefined') {
    const lang = navigator.language.substring(0, 2).toUpperCase();
    const messages = {
      PL: 'Ta przeglƒÖdarka nie obs≈Çuguje BigInt. Zaktualizuj iOS do wersji 14 lub nowszej.',
      EN: 'This browser does not support BigInt. Update iOS to version 14 or newer.',
      DE: 'Dieser Browser unterst√ºtzt BigInt nicht. Aktualisieren Sie iOS auf Version 14 oder neuer.',
      TR: 'Bu tarayƒ±cƒ± BigInt desteklemiyor. iOS\'u s√ºr√ºm 14 veya daha yenisine g√ºncelleyin.',
      RU: '–≠—Ç–æ—Ç –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç BigInt. –û–±–Ω–æ–≤–∏—Ç–µ iOS –¥–æ –≤–µ—Ä—Å–∏–∏ 14 –∏–ª–∏ –Ω–æ–≤–µ–µ.'
    };
    alert(messages[lang] || messages.EN);
  }

  // ================== i18n text ==================
  const T = {
    PL: {
      title: "Kalkulator u≈Çamk√≥w z grafikƒÖ",
      subtitle: "Zobacz jak dzia≈ÇajƒÖ u≈Çamki dziƒôki kolorowym wizualizacjom i szczeg√≥≈Çowym wyja≈õnieniom ka≈ºdego kroku.",
      langLabel: "Jƒôzyk",
      calcHeader: "Obliczenia",
      examples: "Przyk≈Çady: 2 1/3, 3/4, 5",
      aLabel: "Liczba A",
      bLabel: "Liczba B",
      opLabel: "Dzia≈Çanie",
      calcBtn: "Policz i wyt≈Çumacz",
      fillBtn: "Wstaw przyk≈Çad",
      hint: "Liczba mieszana wpisuj jako 2 1/3 (jedna spacja). U≈Çamki jako a/b.",
      resFrac: "Wynik jako u≈Çamek",
      resMix: "Wynik jako mieszana",
      helpHeader: "Jak dzia≈ÇajƒÖ u≈Çamki?",
      helpMini: "Ilustrowany przewodnik",
      stepsDefault: "Tu pojawi siƒô dok≈Çadne wyja≈õnienie krok po kroku z grafikƒÖ.",
      errEmpty: "Uzupe≈Çnij oba pola: A i B.",
      errFormat: "Z≈Çy format. U≈ºyj np. 5 albo 3/4 albo 2 1/3.",
      errDiv0: "Nie mo≈ºna dzieliƒá przez 0.",
      visualTitle: "üìä Wizualizacja dzia≈Çania",
      visualLabelA: "Liczba A",
      visualLabelB: "Liczba B",
      visualLabelResult: "Wynik",
      visualSteps: {
        common_denom_title: "Wsp√≥lny mianownik",
        common_denom_why: "ü§î Po co nam ten sam mianownik?",
        common_denom_explain: "Wyobra≈∫ sobie pizzƒô! Jeden u≈Çamek ma kawa≈Çki po 1/4 pizzy, a drugi po 1/3 pizzy. To sƒÖ r√≥≈ºne kawa≈Çki! Musimy je zamieniƒá na takie same, ≈ºeby m√≥c je dodaƒá lub odjƒÖƒá.",
        lcm_title: "üîç Szukamy wsp√≥lnego mianownika",
        lcm_explain: "Znajdujemy najmniejszƒÖ liczbƒô, kt√≥ra dzieli siƒô przez oba mianowniki (NWW)",
        converting_title: "‚ú® Zamieniamy u≈Çamki na ten sam mianownik",
        converting_explain: "Mno≈ºymy g√≥ra√óta_sama_liczba i d√≥≈Ç√óta_sama_liczba. Tak jakby≈õ pociƒÖ≈Ç pizzƒô na mniejsze kawa≈Çki - masz wiƒôcej kawa≈Çk√≥w, ale ta sama ilo≈õƒá pizzy!",
        multiplier: "Mno≈ºymy przez",
        original: "PoczƒÖtek",
        converted: "Po zamianie",
        computing_title: "üßÆ Teraz liczymy!",
        computing_explain: "Super! Mamy te same kawa≈Çki (mianowniki sƒÖ r√≥wne). Teraz po prostu dodajemy/odejmujemy liczby z g√≥ry (liczniki).",
        multiply_title: "‚úñÔ∏è Mno≈ºymy u≈Çamki",
        multiply_explain: "To jest proste! Mno≈ºymy g√≥rƒô przez g√≥rƒô i d√≥≈Ç przez d√≥≈Ç. Tak jakby≈õ mia≈Ç pude≈Çko 2√ó3 i sprawdza≈Ç ile w nim jest miejsc.",
        divide_title: "‚ûó Dzielimy u≈Çamki",
        divide_explain: "Zamiast dzieliƒá, ODWRACAMY drugi u≈Çamek do g√≥ry nogami i mno≈ºymy! To taka matematyczna sztuczka üé©‚ú®",
        reciprocal: "Odwr√≥cony",
        numerator_x_numerator: "G√≥ra √ó G√≥ra",
        denominator_x_denominator: "D√≥≈Ç √ó D√≥≈Ç",
        piece_size: "Rozmiar kawa≈Çka",
        same_pieces: "Teraz te same kawa≈Çki!",
      },
      helpCards: {
        add: {
          title: "‚ûï Dodawanie",
          desc: "Musisz mieƒá <b>ten sam mianownik</b> (rozmiar kawa≈Çk√≥w). Potem dodajesz tylko liczniki.",
          example: "1/4 + 1/4 = 2/4 = 1/2"
        },
        sub: {
          title: "‚ûñ Odejmowanie",
          desc: "Tak samo jak dodawanie - potrzebny <b>wsp√≥lny mianownik</b>, potem odejmujesz liczniki.",
          example: "3/4 - 1/4 = 2/4 = 1/2"
        },
        mul: {
          title: "‚úñÔ∏è Mno≈ºenie",
          desc: "Proste! Mn√≥≈º <b>licznik √ó licznik</b> i <b>mianownik √ó mianownik</b>.",
          example: "2/3 √ó 3/4 = 6/12 = 1/2"
        },
        div: {
          title: "‚ûó Dzielenie",
          desc: "Zamie≈Ñ na mno≈ºenie! Odwr√≥ƒá drugi u≈Çamek i pomn√≥≈º.",
          example: "1/2 √∑ 1/4 = 1/2 √ó 4/1 = 2"
        }
      }
    },
    EN: {
      title: "Fraction calculator with visuals",
      subtitle: "See how fractions work with colorful visualizations and detailed step-by-step explanations.",
      langLabel: "Language",
      calcHeader: "Calculator",
      examples: "Examples: 2 1/3, 3/4, 5",
      aLabel: "Number A",
      bLabel: "Number B",
      opLabel: "Operator",
      calcBtn: "Calculate + explain",
      fillBtn: "Insert example",
      hint: "Mixed number: 2 1/3 (one space). Fraction: a/b.",
      resFrac: "Result as fraction",
      resMix: "Result as mixed",
      helpHeader: "How fractions work?",
      helpMini: "Visual guide",
      stepsDefault: "A detailed step-by-step explanation with visuals will appear here.",
      errEmpty: "Fill both fields: A and B.",
      errFormat: "Invalid format. Use e.g. 5 or 3/4 or 2 1/3.",
      errDiv0: "Cannot divide by 0.",
      visualTitle: "üìä Visual representation",
      visualLabelA: "Number A",
      visualLabelB: "Number B",
      visualLabelResult: "Result",
      visualSteps: {
        common_denom_title: "Common Denominator",
        common_denom_why: "ü§î Why do we need the same denominator?",
        common_denom_explain: "Imagine a pizza! One fraction has pieces of 1/4 pizza, the other has 1/3 pizza pieces. These are different sizes! We need to make them the same size before we can add or subtract.",
        lcm_title: "üîç Finding the common denominator",
        lcm_explain: "We find the smallest number that divides by both denominators (LCM)",
        converting_title: "‚ú® Converting fractions to the same denominator",
        converting_explain: "We multiply top√ósame_number and bottom√ósame_number. It's like cutting pizza into smaller pieces - you have more pieces, but the same amount of pizza!",
        multiplier: "Multiply by",
        original: "Start",
        converted: "After converting",
        computing_title: "üßÆ Now let's calculate!",
        computing_explain: "Great! We have the same pieces (denominators are equal). Now we just add/subtract the top numbers (numerators).",
        multiply_title: "‚úñÔ∏è Multiplying fractions",
        multiply_explain: "This is easy! Multiply top times top and bottom times bottom. Like counting boxes in a 2√ó3 grid.",
        divide_title: "‚ûó Dividing fractions",
        divide_explain: "Instead of dividing, we FLIP the second fraction upside down and multiply! It's a math magic trick üé©‚ú®",
        reciprocal: "Flipped",
        numerator_x_numerator: "Top √ó Top",
        denominator_x_denominator: "Bottom √ó Bottom",
        piece_size: "Piece size",
        same_pieces: "Now the same pieces!",
      },
      helpCards: {
        add: {
          title: "‚ûï Addition",
          desc: "You need the <b>same denominator</b> (same piece size). Then add only the numerators.",
          example: "1/4 + 1/4 = 2/4 = 1/2"
        },
        sub: {
          title: "‚ûñ Subtraction",
          desc: "Same as addition - need a <b>common denominator</b>, then subtract numerators.",
          example: "3/4 - 1/4 = 2/4 = 1/2"
        },
        mul: {
          title: "‚úñÔ∏è Multiplication",
          desc: "Simple! Multiply <b>numerator √ó numerator</b> and <b>denominator √ó denominator</b>.",
          example: "2/3 √ó 3/4 = 6/12 = 1/2"
        },
        div: {
          title: "‚ûó Division",
          desc: "Change to multiplication! Flip the second fraction and multiply.",
          example: "1/2 √∑ 1/4 = 1/2 √ó 4/1 = 2"
        }
      }
    },
    DE: {
      title: "Bruchrechner mit Grafik",
      subtitle: "Sehe wie Br√ºche funktionieren mit bunten Visualisierungen und detaillierten Schritt-f√ºr-Schritt-Erkl√§rungen.",
      langLabel: "Sprache",
      calcHeader: "Rechner",
      examples: "Beispiele: 2 1/3, 3/4, 5",
      aLabel: "Zahl A",
      bLabel: "Zahl B",
      opLabel: "Operator",
      calcBtn: "Rechnen + erkl√§ren",
      fillBtn: "Beispiel einsetzen",
      hint: "Gemischte Zahl: 2 1/3 (ein Leerzeichen). Bruch: a/b.",
      resFrac: "Ergebnis als Bruch",
      resMix: "Ergebnis als gemischt",
      helpHeader: "Wie funktionieren Br√ºche?",
      helpMini: "Bildlicher Leitfaden",
      stepsDefault: "Hier erscheint eine detaillierte Schritt-f√ºr-Schritt-Erkl√§rung mit Grafik.",
      errEmpty: "Bitte beide Felder ausf√ºllen: A und B.",
      errFormat: "Ung√ºltiges Format. Nutze z.B. 5 oder 3/4 oder 2 1/3.",
      errDiv0: "Division durch 0 ist nicht erlaubt.",
      visualTitle: "üìä Visuelle Darstellung",
      visualLabelA: "Zahl A",
      visualLabelB: "Zahl B",
      visualLabelResult: "Ergebnis",
      visualSteps: {
        common_denom_title: "Gemeinsamer Nenner",
        common_denom_why: "ü§î Warum brauchen wir den gleichen Nenner?",
        common_denom_explain: "Stell dir eine Pizza vor! Ein Bruch hat St√ºcke von 1/4 Pizza, der andere hat 1/3 Pizza St√ºcke. Das sind verschiedene Gr√∂√üen! Wir m√ºssen sie gleich gro√ü machen, bevor wir addieren oder subtrahieren k√∂nnen.",
        lcm_title: "üîç Gemeinsamen Nenner finden",
        lcm_explain: "Wir finden die kleinste Zahl, die durch beide Nenner teilbar ist (kgV)",
        converting_title: "‚ú® Br√ºche auf den gleichen Nenner bringen",
        converting_explain: "Wir multiplizieren oben√ógleiche_Zahl und unten√ógleiche_Zahl. Wie wenn du Pizza in kleinere St√ºcke schneidest - du hast mehr St√ºcke, aber gleich viel Pizza!",
        multiplier: "Multiplizieren mit",
        original: "Start",
        converted: "Nach Umwandlung",
        computing_title: "üßÆ Jetzt rechnen wir!",
        computing_explain: "Super! Wir haben die gleichen St√ºcke (Nenner sind gleich). Jetzt addieren/subtrahieren wir nur die oberen Zahlen (Z√§hler).",
        multiply_title: "‚úñÔ∏è Br√ºche multiplizieren",
        multiply_explain: "Das ist einfach! Oben mal oben und unten mal unten multiplizieren. Wie K√§stchen in einem 2√ó3 Raster z√§hlen.",
        divide_title: "‚ûó Br√ºche dividieren",
        divide_explain: "Statt zu dividieren, drehen wir den zweiten Bruch auf den Kopf und multiplizieren! Das ist ein Mathe-Zaubertrick üé©‚ú®",
        reciprocal: "Umgedreht",
        numerator_x_numerator: "Oben √ó Oben",
        denominator_x_denominator: "Unten √ó Unten",
        piece_size: "St√ºckgr√∂√üe",
        same_pieces: "Jetzt gleiche St√ºcke!",
      },
      helpCards: {
        add: {
          title: "‚ûï Addition",
          desc: "Du brauchst den <b>gleichen Nenner</b> (gleiche St√ºckgr√∂√üe). Dann nur Z√§hler addieren.",
          example: "1/4 + 1/4 = 2/4 = 1/2"
        },
        sub: {
          title: "‚ûñ Subtraktion",
          desc: "Wie Addition - <b>gemeinsamer Nenner</b> n√∂tig, dann Z√§hler subtrahieren.",
          example: "3/4 - 1/4 = 2/4 = 1/2"
        },
        mul: {
          title: "‚úñÔ∏è Multiplikation",
          desc: "Einfach! <b>Z√§hler √ó Z√§hler</b> und <b>Nenner √ó Nenner</b> multiplizieren.",
          example: "2/3 √ó 3/4 = 6/12 = 1/2"
        },
        div: {
          title: "‚ûó Division",
          desc: "In Multiplikation umwandeln! Zweiten Bruch umdrehen und multiplizieren.",
          example: "1/2 √∑ 1/4 = 1/2 √ó 4/1 = 2"
        }
      }
    },
    TR: {
      title: "Grafikli kesir hesaplayƒ±cƒ±",
      subtitle: "Renkli g√∂rselle≈ütirmeler ve ayrƒ±ntƒ±lƒ± adƒ±m adƒ±m a√ßƒ±klamalarla kesirlerin nasƒ±l √ßalƒ±≈ütƒ±ƒüƒ±nƒ± g√∂r√ºn.",
      langLabel: "Dil",
      calcHeader: "Hesaplama",
      examples: "√ñrnekler: 2 1/3, 3/4, 5",
      aLabel: "A Sayƒ±sƒ±",
      bLabel: "B Sayƒ±sƒ±",
      opLabel: "ƒ∞≈ülem",
      calcBtn: "Hesapla ve a√ßƒ±kla",
      fillBtn: "√ñrnek ekle",
      hint: "Karma sayƒ±: 2 1/3 (bir bo≈üluk). Kesir: a/b.",
      resFrac: "Kesir olarak sonu√ß",
      resMix: "Karma olarak sonu√ß",
      helpHeader: "Kesirler nasƒ±l √ßalƒ±≈üƒ±r?",
      helpMini: "G√∂rsel kƒ±lavuz",
      stepsDefault: "Burada g√∂rselli ayrƒ±ntƒ±lƒ± adƒ±m adƒ±m a√ßƒ±klama g√∂r√ºnecek.",
      errEmpty: "Her iki alanƒ± doldurun: A ve B.",
      errFormat: "Ge√ßersiz format. √ñrn: 5 veya 3/4 veya 2 1/3 kullanƒ±n.",
      errDiv0: "Sƒ±fƒ±ra b√∂lme yapƒ±lamaz.",
      visualTitle: "üìä G√∂rsel g√∂sterim",
      visualLabelA: "A Sayƒ±sƒ±",
      visualLabelB: "B Sayƒ±sƒ±",
      visualLabelResult: "Sonu√ß",
      visualSteps: {
        common_denom_title: "Ortak Payda",
        common_denom_why: "ü§î Neden aynƒ± paydaya ihtiyacƒ±mƒ±z var?",
        common_denom_explain: "Bir pizza hayal et! Bir kesir 1/4 pizza par√ßalarƒ±na, diƒüeri 1/3 pizza par√ßalarƒ±na sahip. Bunlar farklƒ± boyutlar! Toplayabilmek veya √ßƒ±karabilmek i√ßin onlarƒ± aynƒ± boyutta yapmamƒ±z gerekir.",
        lcm_title: "üîç Ortak payda bulma",
        lcm_explain: "Her iki paydaya b√∂l√ºnebilen en k√º√ß√ºk sayƒ±yƒ± buluyoruz (EKOK)",
        converting_title: "‚ú® Kesirleri aynƒ± paydaya √ßevirme",
        converting_explain: "√úst√óaynƒ±_sayƒ± ve alt√óaynƒ±_sayƒ± ile √ßarpƒ±yoruz. Pizzayƒ± daha k√º√ß√ºk par√ßalara kesmek gibi - daha fazla par√ßan var ama aynƒ± miktarda pizza!",
        multiplier: "≈ûununla √ßarp",
        original: "Ba≈ülangƒ±√ß",
        converted: "D√∂n√º≈üt√ºr√ºld√ºkten sonra",
        computing_title: "üßÆ ≈ûimdi hesaplayalƒ±m!",
        computing_explain: "Harika! Aynƒ± par√ßalara sahibiz (paydalar e≈üit). ≈ûimdi sadece √ºstteki sayƒ±larƒ± (pay) topluyoruz/√ßƒ±karƒ±yoruz.",
        multiply_title: "‚úñÔ∏è Kesirleri √ßarpma",
        multiply_explain: "Bu kolay! √úst √ßarpƒ± √ºst ve alt √ßarpƒ± alt. 2√ó3 ƒ±zgaradaki kutularƒ± saymak gibi.",
        divide_title: "‚ûó Kesirleri b√∂lme",
        divide_explain: "B√∂lmek yerine, ikinci kesri TERS √áEVƒ∞Rƒ∞P √ßarpƒ±yoruz! Bu bir matematik sihir numarasƒ± üé©‚ú®",
        reciprocal: "Ters √ßevrilmi≈ü",
        numerator_x_numerator: "√úst √ó √úst",
        denominator_x_denominator: "Alt √ó Alt",
        piece_size: "Par√ßa boyutu",
        same_pieces: "≈ûimdi aynƒ± par√ßalar!",
      },
      helpCards: {
        add: {
          title: "‚ûï Toplama",
          desc: "<b>Aynƒ± paydaya</b> (aynƒ± par√ßa boyutu) ihtiyacƒ±nƒ±z var. Sonra sadece paylarƒ± toplayƒ±n.",
          example: "1/4 + 1/4 = 2/4 = 1/2"
        },
        sub: {
          title: "‚ûñ √áƒ±karma",
          desc: "Toplama ile aynƒ± - <b>ortak payda</b> gerekli, sonra paylarƒ± √ßƒ±karƒ±n.",
          example: "3/4 - 1/4 = 2/4 = 1/2"
        },
        mul: {
          title: "‚úñÔ∏è √áarpma",
          desc: "Basit! <b>Pay √ó pay</b> ve <b>payda √ó payda</b> √ßarpƒ±n.",
          example: "2/3 √ó 3/4 = 6/12 = 1/2"
        },
        div: {
          title: "‚ûó B√∂lme",
          desc: "√áarpma i≈ülemine d√∂n√º≈üt√ºr! ƒ∞kinci kesri ters √ßevir ve √ßarp.",
          example: "1/2 √∑ 1/4 = 1/2 √ó 4/1 = 2"
        }
      }
    },
    RU: {
      title: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥—Ä–æ–±–µ–π —Å –≥—Ä–∞—Ñ–∏–∫–æ–π",
      subtitle: "–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –¥—Ä–æ–±–∏, —Å –ø–æ–º–æ—â—å—é –∫—Ä–∞—Å–æ—á–Ω—ã—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π –∏ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ø–æ—à–∞–≥–æ–≤—ã—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π.",
      langLabel: "–Ø–∑—ã–∫",
      calcHeader: "–í—ã—á–∏—Å–ª–µ–Ω–∏–µ",
      examples: "–ü—Ä–∏–º–µ—Ä—ã: 2 1/3, 3/4, 5",
      aLabel: "–ß–∏—Å–ª–æ A",
      bLabel: "–ß–∏—Å–ª–æ B",
      opLabel: "–û–ø–µ—Ä–∞—Ü–∏—è",
      calcBtn: "–í—ã—á–∏—Å–ª–∏—Ç—å –∏ –æ–±—ä—è—Å–Ω–∏—Ç—å",
      fillBtn: "–í—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä",
      hint: "–°–º–µ—à–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ: 2 1/3 (–æ–¥–∏–Ω –ø—Ä–æ–±–µ–ª). –î—Ä–æ–±—å: a/b.",
      resFrac: "–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –¥—Ä–æ–±—å",
      resMix: "–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ —Å–º–µ—à–∞–Ω–Ω–æ–µ",
      helpHeader: "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –¥—Ä–æ–±–∏?",
      helpMini: "–í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ",
      stepsDefault: "–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ø–æ—à–∞–≥–æ–≤–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å –≥—Ä–∞—Ñ–∏–∫–æ–π.",
      errEmpty: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è: A –∏ B.",
      errFormat: "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: 5 –∏–ª–∏ 3/4 –∏–ª–∏ 2 1/3.",
      errDiv0: "–ù–µ–ª—å–∑—è –¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–æ–ª—å.",
      visualTitle: "üìä –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ",
      visualLabelA: "–ß–∏—Å–ª–æ A",
      visualLabelB: "–ß–∏—Å–ª–æ B",
      visualLabelResult: "–†–µ–∑—É–ª—å—Ç–∞—Ç",
      visualSteps: {
        common_denom_title: "–û–±—â–∏–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å",
        common_denom_why: "ü§î –ó–∞—á–µ–º –Ω–∞–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å?",
        common_denom_explain: "–ü—Ä–µ–¥—Å—Ç–∞–≤—å –ø–∏—Ü—Ü—É! –û–¥–Ω–∞ –¥—Ä–æ–±—å –∏–º–µ–µ—Ç –∫—É—Å–æ—á–∫–∏ 1/4 –ø–∏—Ü—Ü—ã, –∞ –¥—Ä—É–≥–∞—è - –∫—É—Å–æ—á–∫–∏ 1/3 –ø–∏—Ü—Ü—ã. –≠—Ç–æ —Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã! –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏, –ø—Ä–µ–∂–¥–µ —á–µ–º —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –∏–ª–∏ –≤—ã—á–∏—Ç–∞—Ç—å.",
        lcm_title: "üîç –ü–æ–∏—Å–∫ –æ–±—â–µ–≥–æ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è",
        lcm_explain: "–ù–∞—Ö–æ–¥–∏–º –Ω–∞–∏–º–µ–Ω—å—à–µ–µ —á–∏—Å–ª–æ, –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –æ–±–∞ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è (–ù–û–ö)",
        converting_title: "‚ú® –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥—Ä–æ–±–µ–π –∫ –æ–±—â–µ–º—É –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—é",
        converting_explain: "–£–º–Ω–æ–∂–∞–µ–º –≤–µ—Ä—Ö√ó—Ç–æ_–∂–µ_—á–∏—Å–ª–æ –∏ –Ω–∏–∑√ó—Ç–æ_–∂–µ_—á–∏—Å–ª–æ. –≠—Ç–æ –∫–∞–∫ —Ä–∞–∑—Ä–µ–∑–∞—Ç—å –ø–∏—Ü—Ü—É –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –∫—É—Å–æ—á–∫–∏ - —É —Ç–µ–±—è –±–æ–ª—å—à–µ –∫—É—Å–æ—á–∫–æ–≤, –Ω–æ —Ç–æ –∂–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏—Ü—Ü—ã!",
        multiplier: "–£–º–Ω–æ–∂–∏—Ç—å –Ω–∞",
        original: "–ù–∞—á–∞–ª–æ",
        converted: "–ü–æ—Å–ª–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è",
        computing_title: "üßÆ –¢–µ–ø–µ—Ä—å –≤—ã—á–∏—Å–ª—è–µ–º!",
        computing_explain: "–û—Ç–ª–∏—á–Ω–æ! –£ –Ω–∞—Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫—É—Å–æ—á–∫–∏ (–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–∏ —Ä–∞–≤–Ω—ã). –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ —Å–∫–ª–∞–¥—ã–≤–∞–µ–º/–≤—ã—á–∏—Ç–∞–µ–º –≤–µ—Ä—Ö–Ω–∏–µ —á–∏—Å–ª–∞ (—á–∏—Å–ª–∏—Ç–µ–ª–∏).",
        multiply_title: "‚úñÔ∏è –£–º–Ω–æ–∂–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π",
        multiply_explain: "–≠—Ç–æ –ª–µ–≥–∫–æ! –£–º–Ω–æ–∂–∞–µ–º –≤–µ—Ä—Ö –Ω–∞ –≤–µ—Ä—Ö –∏ –Ω–∏–∑ –Ω–∞ –Ω–∏–∑. –ö–∞–∫ —Å—á–∏—Ç–∞—Ç—å –∫–ª–µ—Ç–∫–∏ –≤ —Å–µ—Ç–∫–µ 2√ó3.",
        divide_title: "‚ûó –î–µ–ª–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π",
        divide_explain: "–í–º–µ—Å—Ç–æ –¥–µ–ª–µ–Ω–∏—è –ü–ï–†–ï–í–û–†–ê–ß–ò–í–ê–ï–ú –≤—Ç–æ—Ä—É—é –¥—Ä–æ–±—å –≤–≤–µ—Ä—Ö –Ω–æ–≥–∞–º–∏ –∏ —É–º–Ω–æ–∂–∞–µ–º! –≠—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–æ–∫—É—Å üé©‚ú®",
        reciprocal: "–ü–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞—è",
        numerator_x_numerator: "–í–µ—Ä—Ö √ó –í–µ—Ä—Ö",
        denominator_x_denominator: "–ù–∏–∑ √ó –ù–∏–∑",
        piece_size: "–†–∞–∑–º–µ—Ä –∫—É—Å–æ—á–∫–∞",
        same_pieces: "–¢–µ–ø–µ—Ä—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫—É—Å–æ—á–∫–∏!",
      },
      helpCards: {
        add: {
          title: "‚ûï –°–ª–æ–∂–µ–Ω–∏–µ",
          desc: "–ù—É–∂–µ–Ω <b>–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å</b> (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∫—É—Å–æ—á–∫–æ–≤). –ó–∞—Ç–µ–º —Å–∫–ª–∞–¥—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∏—Ç–µ–ª–∏.",
          example: "1/4 + 1/4 = 2/4 = 1/2"
        },
        sub: {
          title: "‚ûñ –í—ã—á–∏—Ç–∞–Ω–∏–µ",
          desc: "–¢–∞–∫ –∂–µ, –∫–∞–∫ —Å–ª–æ–∂–µ–Ω–∏–µ - –Ω—É–∂–µ–Ω <b>–æ–±—â–∏–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å</b>, –∑–∞—Ç–µ–º –≤—ã—á–∏—Ç–∞–µ–º —á–∏—Å–ª–∏—Ç–µ–ª–∏.",
          example: "3/4 - 1/4 = 2/4 = 1/2"
        },
        mul: {
          title: "‚úñÔ∏è –£–º–Ω–æ–∂–µ–Ω–∏–µ",
          desc: "–ü—Ä–æ—Å—Ç–æ! –£–º–Ω–æ–∂–∞–µ–º <b>—á–∏—Å–ª–∏—Ç–µ–ª—å √ó —á–∏—Å–ª–∏—Ç–µ–ª—å</b> –∏ <b>–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å √ó –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å</b>.",
          example: "2/3 √ó 3/4 = 6/12 = 1/2"
        },
        div: {
          title: "‚ûó –î–µ–ª–µ–Ω–∏–µ",
          desc: "–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —É–º–Ω–æ–∂–µ–Ω–∏–µ! –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Ç–æ—Ä—É—é –¥—Ä–æ–±—å –∏ —É–º–Ω–æ–∂–∞–µ–º.",
          example: "1/2 √∑ 1/4 = 1/2 √ó 4/1 = 2"
        }
      }
    }
  };

  // ================== DOM ==================
  const $ = (id) => document.getElementById(id);

  const langSelect = $("langSelect");
  const opSelect = $("opSelect");
  const aInput = $("aInput");
  const bInput = $("bInput");
  const calcBtn = $("calcBtn");
  const fillBtn = $("fillBtn");
  const stepsEl = $("steps");
  const resFracEl = $("resFrac");
  const resMixEl = $("resMix");
  const toast = $("toast");
  const themeBtn = $("themeBtn");
  const visualSection = $("visualSection");
  const fractionVisual = $("fractionVisual");
  const pieVisual = $("pieVisual");
  const visualExplanation = $("visualExplanation");

  // ================== helpers (fractions with BigInt) ==================
  function gcd(a, b){
    a = a < 0n ? -a : a;
    b = b < 0n ? -b : b;
    while (b !== 0n){
      const t = b;
      b = a % b;
      a = t;
    }
    return a;
  }

  function lcm(a, b){
    return (a / gcd(a,b)) * b;
  }

  function norm(n, d){
    if (d === 0n) throw new Error("DIV0");
    if (d < 0n){ n = -n; d = -d; }
    const g = gcd(n, d);
    return { n: n/g, d: d/g };
  }

  function fracToString(fr){
    return `${fr.n}/${fr.d}`;
  }

  function toMixed(fr){
    const n = fr.n, d = fr.d;
    const sign = n < 0n ? -1n : 1n;
    const an = n < 0n ? -n : n;
    const whole = (an / d) * sign;
    const rest = an % d;

    if (rest === 0n) return `${whole}`;
    if (whole === 0n) return `${sign < 0n ? "-" : ""}${rest}/${d}`;
    return `${whole} ${rest}/${d}`;
  }

  function parseFraction(text){
    const s = text.trim();
    if (!s) throw new Error("EMPTY");

    if (s.includes(" ")){
      const parts = s.split(/\s+/).filter(Boolean);
      if (parts.length !== 2) throw new Error("FORMAT");
      const whole = BigInt(parts[0]);
      const fr = parseFraction(parts[1]);
      const wholeAs = norm(whole * fr.d, fr.d);
      return norm(wholeAs.n + fr.n, fr.d);
    }

    if (s.includes("/")){
      const [a,b] = s.split("/");
      if (a === "" || b === "") throw new Error("FORMAT");
      return norm(BigInt(a), BigInt(b));
    }

    return norm(BigInt(s), 1n);
  }

  // ================== Visual helpers ==================
  function drawFractionBox(n, d, labelKey, lang){
    const tt = T[lang];
    const labels = {
      'A': tt.visualLabelA,
      'B': tt.visualLabelB,
      'Result': tt.visualLabelResult
    };
    
    const box = document.createElement('div');
    box.className = 'fraction-box';
    
    const display = document.createElement('div');
    display.className = 'fraction-display';
    
    const num = document.createElement('div');
    num.className = 'numerator';
    num.textContent = n;
    
    const line = document.createElement('div');
    line.className = 'fraction-line';
    
    const denom = document.createElement('div');
    denom.className = 'denominator';
    denom.textContent = d;
    
    display.appendChild(num);
    display.appendChild(line);
    display.appendChild(denom);
    
    const labelEl = document.createElement('div');
    labelEl.className = 'pie-label';
    labelEl.textContent = labels[labelKey] || labelKey;
    
    box.appendChild(display);
    box.appendChild(labelEl);
    
    return box;
  }

  function drawPieChart(numerator, denominator, label, canvasId){
    const wrapper = document.createElement('div');
    wrapper.className = 'pie-wrapper';
    
    const canvas = document.createElement('canvas');
    canvas.id = canvasId;
    const dpr = window.devicePixelRatio || 1;
    canvas.width = 120 * dpr;
    canvas.height = 120 * dpr;
    canvas.style.width = '120px';
    canvas.style.height = '120px';
    
    const labelEl = document.createElement('div');
    labelEl.className = 'pie-label';
    labelEl.textContent = label;
    
    wrapper.appendChild(labelEl);
    wrapper.appendChild(canvas);
    
    setTimeout(() => {
      const ctx = canvas.getContext('2d');
      ctx.scale(dpr, dpr);
      
      const centerX = 60;
      const centerY = 60;
      const radius = 50;
      
      const isDark = document.body.dataset.theme === 'dark';
      
      // Background circle
      ctx.fillStyle = isDark ? 'rgba(255,255,255,0.08)' : 'rgba(2,6,23,0.08)';
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
      ctx.fill();
      
      // Filled portion
      const angle = (numerator / denominator) * 2 * Math.PI;
      const gradient = ctx.createLinearGradient(0, 0, 120, 120);
      gradient.addColorStop(0, '#7c5cff');
      gradient.addColorStop(1, '#38bdf8');
      
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius, -Math.PI / 2, -Math.PI / 2 + angle);
      ctx.closePath();
      ctx.fill();
      
      // Division lines
      ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.4)' : 'rgba(2,6,23,0.4)';
      ctx.lineWidth = 2;
      for(let i = 0; i < denominator; i++){
        const a = (i / denominator) * 2 * Math.PI - Math.PI / 2;
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(
          centerX + radius * Math.cos(a),
          centerY + radius * Math.sin(a)
        );
        ctx.stroke();
      }
      
      // Border
      ctx.strokeStyle = isDark ? 'rgba(255,255,255,0.2)' : 'rgba(2,6,23,0.2)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
      ctx.stroke();
      
      // Text
      ctx.fillStyle = isDark ? 'rgba(255,255,255,0.9)' : 'rgba(2,6,23,0.9)';
      ctx.font = 'bold 16px monospace';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(`${numerator}/${denominator}`, centerX, centerY);
    }, 10);
    
    return wrapper;
  }

  function createVisualExplanation(A, B, op, result, lang) {
    const tt = T[lang].visualSteps;
    const labels = T[lang];
    visualExplanation.innerHTML = '';
    
    if (op === '+' || op === '-') {
      // Addition/Subtraction - show common denominator process
      const da = A.d, db = B.d;
      const L = lcm(da, db);
      const mA = L / da;
      const mB = L / db;
      const A2 = norm(A.n * mA, A.d * mA);
      const B2 = norm(B.n * mB, B.d * mB);
      
      // Step 1: Why common denominator
      const step1 = document.createElement('div');
      step1.className = 'visual-step';
      step1.innerHTML = `
        <div class="visual-step-title">
          <span class="step-number">1</span>
          <span>${tt.common_denom_why}</span>
        </div>
        <div class="visual-step-content">
          <p style="margin: 8px 0; line-height: 1.6;">${tt.common_denom_explain}</p>
        </div>
        <div class="explanation-grid">
          <div class="explanation-card">
            <div class="explanation-card-title">${labels.visualLabelA}</div>
            <div class="explanation-card-value">${fracToString(A)}</div>
            <div style="font-size:11px; color:var(--muted); margin-top:6px;">
              ${tt.piece_size}: 1/${da}
            </div>
          </div>
          <div class="explanation-card">
            <div class="explanation-card-title">${labels.visualLabelB}</div>
            <div class="explanation-card-value">${fracToString(B)}</div>
            <div style="font-size:11px; color:var(--muted); margin-top:6px;">
              ${tt.piece_size}: 1/${db}
            </div>
          </div>
        </div>
      `;
      visualExplanation.appendChild(step1);
      
      // Step 2: Finding LCM
      const step2 = document.createElement('div');
      step2.className = 'visual-step';
      step2.innerHTML = `
        <div class="visual-step-title">
          <span class="step-number">2</span>
          <span>${tt.lcm_title}</span>
        </div>
        <div class="visual-step-content">
          <p style="margin: 8px 0;">${tt.lcm_explain}</p>
          <div style="text-align: center; margin: 12px 0;">
            <span class="lcm-box">NWW(${da}, ${db}) = ${L}</span>
          </div>
          <p style="margin: 8px 0; font-size: 12px; color: var(--muted);">
            ${tt.same_pieces}
          </p>
        </div>
      `;
      visualExplanation.appendChild(step2);
      
      // Step 3: Converting fractions
      const step3 = document.createElement('div');
      step3.className = 'visual-step';
      step3.innerHTML = `
        <div class="visual-step-title">
          <span class="step-number">3</span>
          <span>${tt.converting_title}</span>
        </div>
        <div class="visual-step-content">
          <p style="margin: 8px 0; line-height: 1.6;">${tt.converting_explain}</p>
        </div>
        <div class="fraction-comparison">
          <div>
            <div style="font-size:11px; color:var(--muted); margin-bottom:6px; font-weight:600;">${tt.original}</div>
            <div style="font-family:var(--mono); font-size:20px; font-weight:700;">${fracToString(A)}</div>
          </div>
          <div class="arrow">√ó</div>
          <div class="multiplier-box">${mA}/${mA}</div>
          <div class="arrow">‚Üí</div>
          <div>
            <div style="font-size:11px; color:var(--good); margin-bottom:6px; font-weight:600;">${tt.converted}</div>
            <div style="font-family:var(--mono); font-size:20px; font-weight:700; color:var(--good);">${fracToString(A2)}</div>
          </div>
        </div>
        <div class="fraction-comparison">
          <div>
            <div style="font-size:11px; color:var(--muted); margin-bottom:6px; font-weight:600;">${tt.original}</div>
            <div style="font-family:var(--mono); font-size:20px; font-weight:700;">${fracToString(B)}</div>
          </div>
          <div class="arrow">√ó</div>
          <div class="multiplier-box">${mB}/${mB}</div>
          <div class="arrow">‚Üí</div>
          <div>
            <div style="font-size:11px; color:var(--good); margin-bottom:6px; font-weight:600;">${tt.converted}</div>
            <div style="font-family:var(--mono); font-size:20px; font-weight:700; color:var(--good);">${fracToString(B2)}</div>
          </div>
        </div>
      `;
      visualExplanation.appendChild(step3);
      
      // Step 4: Computing
      const step4 = document.createElement('div');
      step4.className = 'visual-step';
      const opSymbol = op === '+' ? '+' : '‚àí';
      const computation = op === '+' ? `${A2.n} + ${B2.n}` : `${A2.n} ‚àí ${B2.n}`;
      const resultNum = op === '+' ? A2.n + B2.n : A2.n - B2.n;
      step4.innerHTML = `
        <div class="visual-step-title">
          <span class="step-number">4</span>
          <span>${tt.computing_title}</span>
        </div>
        <div class="visual-step-content">
          <p style="margin: 8px 0; line-height: 1.6;">${tt.computing_explain}</p>
        </div>
        <div class="fraction-comparison" style="justify-content: center;">
          <div style="font-family:var(--mono); font-size:18px; font-weight:700; text-align:center; line-height:1.8;">
            <div>${fracToString(A2)} ${opSymbol} ${fracToString(B2)} =</div>
            <div style="color:var(--accent2); margin: 8px 0;">(${computation})/${L} =</div>
            <div style="color:var(--good); font-size:22px;">${fracToString(result)}</div>
          </div>
        </div>
      `;
      visualExplanation.appendChild(step4);
      
    } else if (op === '*') {
      // Multiplication
      const step1 = document.createElement('div');
      step1.className = 'visual-step';
      step1.innerHTML = `
        <div class="visual-step-title">
          <span class="step-number">1</span>
          <span>${tt.multiply_title}</span>
        </div>
        <div class="visual-step-content">
          <p style="margin: 8px 0; line-height: 1.6;">${tt.multiply_explain}</p>
        </div>
        <div class="explanation-grid">
          <div class="explanation-card">
            <div class="explanation-card-title">${tt.numerator_x_numerator}</div>
            <div class="explanation-card-value">${A.n} √ó ${B.n} = ${A.n * B.n}</div>
          </div>
          <div class="explanation-card">
            <div class="explanation-card-title">${tt.denominator_x_denominator}</div>
            <div class="explanation-card-value">${A.d} √ó ${B.d} = ${A.d * B.d}</div>
          </div>
        </div>
        <div class="fraction-comparison" style="justify-content: center;">
          <div style="font-family:var(--mono); font-size:18px; font-weight:700; text-align:center; line-height:1.8;">
            <div>${fracToString(A)} √ó ${fracToString(B)} =</div>
            <div style="color:var(--accent2); margin: 8px 0;">${A.n * B.n}/${A.d * B.d} =</div>
            <div style="color:var(--good); font-size:22px;">${fracToString(result)}</div>
          </div>
        </div>
      `;
      visualExplanation.appendChild(step1);
      
    } else if (op === '/') {
      // Division
      const B_inv = norm(B.d, B.n);
      
      const step1 = document.createElement('div');
      step1.className = 'visual-step';
      step1.innerHTML = `
        <div class="visual-step-title">
          <span class="step-number">1</span>
          <span>${tt.divide_title}</span>
        </div>
        <div class="visual-step-content">
          <p style="margin: 8px 0; line-height: 1.6;">${tt.divide_explain}</p>
        </div>
        <div class="fraction-comparison" style="justify-content: center;">
          <div>
            <div style="font-size:11px; color:var(--muted); margin-bottom:6px; font-weight:600;">${tt.original}</div>
            <div style="font-family:var(--mono); font-size:20px; font-weight:700;">${fracToString(B)}</div>
          </div>
          <div class="arrow" style="font-size:32px;">üîÑ</div>
          <div>
            <div style="font-size:11px; color:var(--warn); margin-bottom:6px; font-weight:600;">${tt.reciprocal}</div>
            <div style="font-family:var(--mono); font-size:20px; font-weight:700; color:var(--warn);">${fracToString(B_inv)}</div>
          </div>
        </div>
      `;
      visualExplanation.appendChild(step1);
      
      const step2 = document.createElement('div');
      step2.className = 'visual-step';
      step2.innerHTML = `
        <div class="visual-step-title">
          <span class="step-number">2</span>
          <span>${tt.multiply_title}</span>
        </div>
        <div class="visual-step-content">
          <p style="margin: 8px 0;">${tt.multiply_explain}</p>
        </div>
        <div class="explanation-grid">
          <div class="explanation-card">
            <div class="explanation-card-title">${tt.numerator_x_numerator}</div>
            <div class="explanation-card-value">${A.n} √ó ${B_inv.n} = ${A.n * B_inv.n}</div>
          </div>
          <div class="explanation-card">
            <div class="explanation-card-title">${tt.denominator_x_denominator}</div>
            <div class="explanation-card-value">${A.d} √ó ${B_inv.d} = ${A.d * B_inv.d}</div>
          </div>
        </div>
        <div class="fraction-comparison" style="justify-content: center;">
          <div style="font-family:var(--mono); font-size:18px; font-weight:700; text-align:center; line-height:1.8;">
            <div>${fracToString(A)} √ó ${fracToString(B_inv)} =</div>
            <div style="color:var(--accent2); margin: 8px 0;">${A.n * B_inv.n}/${A.d * B_inv.d} =</div>
            <div style="color:var(--good); font-size:22px;">${fracToString(result)}</div>
          </div>
        </div>
      `;
      visualExplanation.appendChild(step2);
    }
  }

  function createVisuals(A, B, op, result, lang){
    const tt = T[lang];
    
    // Clear previous content
    visualExplanation.innerHTML = '';
    fractionVisual.innerHTML = '';
    pieVisual.innerHTML = '';
    
    // Update visual section title
    document.querySelector('.visual-title').textContent = tt.visualTitle;
    
    // Create detailed visual explanation
    createVisualExplanation(A, B, op, result, lang);
    
    // Create fraction display
    const container = document.createElement('div');
    container.className = 'fraction-visual';
    
    container.appendChild(drawFractionBox(A.n, A.d, 'A', lang));
    
    const opEl = document.createElement('div');
    opEl.className = 'operator';
    opEl.textContent = op;
    container.appendChild(opEl);
    
    container.appendChild(drawFractionBox(B.n, B.d, 'B', lang));
    
    const eqEl = document.createElement('div');
    eqEl.className = 'operator';
    eqEl.textContent = '=';
    container.appendChild(eqEl);
    
    container.appendChild(drawFractionBox(result.n, result.d, 'Result', lang));
    
    fractionVisual.appendChild(container);
    
    // Pie charts
    const pieContainer = document.createElement('div');
    pieContainer.className = 'pie-container';
    
    // Only draw pies for reasonable denominators
    const maxDenom = 12;
    if (Number(A.d) <= maxDenom && Number(A.d) > 0) {
      pieContainer.appendChild(drawPieChart(Number(A.n), Number(A.d), tt.visualLabelA, 'pieA'));
    }
    if (Number(B.d) <= maxDenom && Number(B.d) > 0) {
      pieContainer.appendChild(drawPieChart(Number(B.n), Number(B.d), tt.visualLabelB, 'pieB'));
    }
    if (Number(result.d) <= maxDenom && Number(result.d) > 0) {
      pieContainer.appendChild(drawPieChart(Number(result.n), Number(result.d), tt.visualLabelResult, 'pieResult'));
    }
    
    pieVisual.appendChild(pieContainer);
    visualSection.style.display = 'block';
  }

  // ================== Explanation builder ==================
  function explain(lang, A_text, op, B_text){
    const tt = T[lang];
    const A = parseFraction(A_text);
    const B = parseFraction(B_text);

    const lines = [];
    const NL = () => lines.push("");

    if (lang === "PL"){
      lines.push("KROK 1 ‚Äî ZAMIANA NA JEDEN FORMAT (u≈Çamki):");
      lines.push(`A = "${A_text}"  ‚Üí  A = ${fracToString(A)}`);
      lines.push(`B = "${B_text}"  ‚Üí  B = ${fracToString(B)}`);
      lines.push("Po co? ≈ªeby zawsze liczyƒá tym samym sposobem (bez wyjƒÖtk√≥w).");
      NL();
    } else if (lang === "EN"){
      lines.push("STEP 1 ‚Äî PARSE INTO ONE FORMAT (fractions):");
      lines.push(`A = "${A_text}"  ‚Üí  A = ${fracToString(A)}`);
      lines.push(`B = "${B_text}"  ‚Üí  B = ${fracToString(B)}`);
      lines.push("Why? So we always calculate in one consistent way.");
      NL();
    } else {
      lines.push("SCHRITT 1 ‚Äî IN EIN FORMAT UMWANDELN (Br√ºche):");
      lines.push(`A = "${A_text}"  ‚Üí  A = ${fracToString(A)}`);
      lines.push(`B = "${B_text}"  ‚Üí  B = ${fracToString(B)}`);
      lines.push("Warum? Damit wir immer auf die gleiche Weise rechnen.");
      NL();
    }

    let result;

    if (op === "+" || op === "-"){
      const da = A.d, db = B.d;
      const L = lcm(da, db);
      const mA = L / da;
      const mB = L / db;

      const A2 = norm(A.n * mA, A.d * mA);
      const B2 = norm(B.n * mB, B.d * mB);

      if (lang === "PL"){
        lines.push("KROK 2 ‚Äî DLACZEGO WSP√ìLNY MIANOWNIK?");
        lines.push("Przy + i - musisz dodawaƒá/odejmowaƒá kawa≈Çki TEGO SAMEGO ROZMIARU.");
        lines.push(`Tu: A ma mianownik ${da} (kawa≈Çek = 1/${da}), a B ma mianownik ${db} (kawa≈Çek = 1/${db}).`);
        lines.push("Najpierw zmieniamy oba u≈Çamki tak, ≈ºeby mia≈Çy TEN SAM mianownik.");
        NL();

        lines.push("KROK 3 ‚Äî SKƒÑD SIƒò BIERZE WSP√ìLNY MIANOWNIK?");
        lines.push("Bierzemy najmniejszƒÖ liczbƒô, kt√≥ra dzieli siƒô przez oba mianowniki (NWW / LCM).");
        lines.push(`LCM(${da}, ${db}) = ${L}`);
        NL();

        lines.push("KROK 4 ‚Äî JAK ZAMIENIAMY U≈ÅAMKI NA TEN SAM MIANOWNIK?");
        lines.push("≈ªeby nie zmieniƒá warto≈õci u≈Çamka, mno≈ºymy LICZNIK i MIANOWNIK przez tƒô samƒÖ liczbƒô.");
        lines.push(`A = ${fracToString(A)}. ≈ªeby mieƒá mianownik ${L}, mno≈ºymy przez ${mA}/${mA}.`);
        lines.push(`A' = (${A.n}√ó${mA})/(${A.d}√ó${mA}) = ${fracToString(A2)}`);
        lines.push(`B = ${fracToString(B)}. ≈ªeby mieƒá mianownik ${L}, mno≈ºymy przez ${mB}/${mB}.`);
        lines.push(`B' = (${B.n}√ó${mB})/(${B.d}√ó${mB}) = ${fracToString(B2)}`);
        NL();

        lines.push("KROK 5 ‚Äî TERAZ W≈ÅA≈öCIWE DODAWANIE / ODEJMOWANIE:");
        lines.push("Gdy mianowniki sƒÖ r√≥wne, zostawiamy mianownik i liczymy TYLKO liczniki.");
      } else if (lang === "EN"){
        lines.push("STEP 2 ‚Äî WHY A COMMON DENOMINATOR?");
        lines.push("For + and -, you must combine pieces of the SAME size.");
        lines.push(`Here: denominators are ${da} and ${db}. Different piece sizes ‚Üí rewrite them first.`);
        NL();

        lines.push("STEP 3 ‚Äî WHERE DOES IT COME FROM?");
        lines.push("We take the smallest number divisible by both denominators (LCM).");
        lines.push(`LCM(${da}, ${db}) = ${L}`);
        NL();

        lines.push("STEP 4 ‚Äî HOW DO WE REWRITE FRACTIONS?");
        lines.push("To keep the value the same, multiply numerator AND denominator by the same number.");
        lines.push(`A = ${fracToString(A)}. To reach denominator ${L}, multiply by ${mA}/${mA}.`);
        lines.push(`A' = (${A.n}√ó${mA})/(${A.d}√ó${mA}) = ${fracToString(A2)}`);
        lines.push(`B = ${fracToString(B)}. To reach denominator ${L}, multiply by ${mB}/${mB}.`);
        lines.push(`B' = (${B.n}√ó${mB})/(${B.d}√ó${mB}) = ${fracToString(B2)}`);
        NL();

        lines.push("STEP 5 ‚Äî NOW ADD / SUBTRACT:");
        lines.push("With equal denominators, keep the denominator and compute ONLY numerators.");
      } else {
        lines.push("SCHRITT 2 ‚Äî WARUM GEMEINSAMER NENNER?");
        lines.push("F√ºr + und - muss man St√ºcke der GLEICHEN Gr√∂√üe zusammenrechnen.");
        lines.push(`Hier: Nenner ${da} und ${db}. Also erst auf gleichen Nenner bringen.`);
        NL();

        lines.push("SCHRITT 3 ‚Äî WOHER KOMMT ER?");
        lines.push("Wir nehmen das kleinste gemeinsame Vielfache (LCM/kgV).");
        lines.push(`LCM(${da}, ${db}) = ${L}`);
        NL();

        lines.push("SCHRITT 4 ‚Äî WIE UMSCHREIBEN WIR DIE BR√úCHE?");
        lines.push("Damit der Wert gleich bleibt: Z√§hler UND Nenner mit derselben Zahl multiplizieren.");
        lines.push(`A = ${fracToString(A)}. F√ºr Nenner ${L}: mit ${mA}/${mA} multiplizieren.`);
        lines.push(`A' = (${A.n}√ó${mA})/(${A.d}√ó${mA}) = ${fracToString(A2)}`);
        lines.push(`B = ${fracToString(B)}. F√ºr Nenner ${L}: mit ${mB}/${mB} multiplizieren.`);
        lines.push(`B' = (${B.n}√ó${mB})/(${B.d}√ó${mB}) = ${fracToString(B2)}`);
        NL();

        lines.push("SCHRITT 5 ‚Äî JETZT RECHNEN:");
        lines.push("Bei gleichem Nenner bleibt der Nenner gleich, nur Z√§hler rechnen.");
      }

      let raw;
      if (op === "+"){
        raw = norm(A2.n + B2.n, L);
        result = norm(A.n * B.d + B.n * A.d, A.d * B.d);
        if (lang === "PL"){
          lines.push(`${fracToString(A2)} + ${fracToString(B2)} = (${A2.n} + ${B2.n})/${L}`);
          lines.push(`= ${A2.n + B2.n}/${L} = ${fracToString(raw)}`);
        } else if (lang === "EN"){
          lines.push(`${fracToString(A2)} + ${fracToString(B2)} = (${A2.n} + ${B2.n})/${L}`);
          lines.push(`= ${A2.n + B2.n}/${L} = ${fracToString(raw)}`);
        } else {
          lines.push(`${fracToString(A2)} + ${fracToString(B2)} = (${A2.n} + ${B2.n})/${L}`);
          lines.push(`= ${A2.n + B2.n}/${L} = ${fracToString(raw)}`);
        }
      } else {
        raw = norm(A2.n - B2.n, L);
        result = norm(A.n * B.d - B.n * A.d, A.d * B.d);
        lines.push(`${fracToString(A2)} - ${fracToString(B2)} = (${A2.n} - ${B2.n})/${L}`);
        lines.push(`= ${A2.n - B2.n}/${L} = ${fracToString(raw)}`);
      }

      NL();
      if (lang === "PL"){
        lines.push("KROK 6 ‚Äî WYNIK KO≈ÉCOWY:");
        lines.push(`U≈Çamek: ${fracToString(result)}`);
        lines.push(`Mieszana: ${toMixed(result)}`);
      } else if (lang === "EN"){
        lines.push("STEP 6 ‚Äî FINAL RESULT:");
        lines.push(`Fraction: ${fracToString(result)}`);
        lines.push(`Mixed: ${toMixed(result)}`);
      } else {
        lines.push("SCHRITT 6 ‚Äî ENDERGEBNIS:");
        lines.push(`Bruch: ${fracToString(result)}`);
        lines.push(`Gemischt: ${toMixed(result)}`);
      }

    } else if (op === "*"){
      const raw = norm(A.n * B.n, A.d * B.d);
      result = raw;

      if (lang === "PL"){
        lines.push("KROK 2 ‚Äî MNO≈ªENIE:");
        lines.push("Tu nie potrzeba wsp√≥lnego mianownika.");
        lines.push("Mno≈ºymy licznik√ólicznik i mianownik√ómianownik:");
        lines.push(`${fracToString(A)} √ó ${fracToString(B)} = (${A.n}√ó${B.n})/(${A.d}√ó${B.d})`);
        lines.push(`= ${A.n * B.n}/${A.d * B.d} = ${fracToString(raw)}`);
        NL();
        lines.push("WYNIK:");
        lines.push(`U≈Çamek: ${fracToString(result)}`);
        lines.push(`Mieszana: ${toMixed(result)}`);
      } else if (lang === "EN"){
        lines.push("STEP 2 ‚Äî MULTIPLY:");
        lines.push("No common denominator needed.");
        lines.push("Multiply numerator√ónumerator and denominator√ódenominator:");
        lines.push(`${fracToString(A)} √ó ${fracToString(B)} = (${A.n}√ó${B.n})/(${A.d}√ó${B.d})`);
        lines.push(`= ${A.n * B.n}/${A.d * B.d} = ${fracToString(raw)}`);
        NL();
        lines.push("RESULT:");
        lines.push(`Fraction: ${fracToString(result)}`);
        lines.push(`Mixed: ${toMixed(result)}`);
      } else {
        lines.push("SCHRITT 2 ‚Äî MULTIPLIKATION:");
        lines.push("Kein gemeinsamer Nenner n√∂tig.");
        lines.push("Z√§hler√óZ√§hler und Nenner√óNenner:");
        lines.push(`${fracToString(A)} √ó ${fracToString(B)} = (${A.n}√ó${B.n})/(${A.d}√ó${B.d})`);
        lines.push(`= ${A.n * B.n}/${A.d * B.d} = ${fracToString(raw)}`);
        NL();
        lines.push("ERGEBNIS:");
        lines.push(`Bruch: ${fracToString(result)}`);
        lines.push(`Gemischt: ${toMixed(result)}`);
      }

    } else {
      if (B.n === 0n) throw new Error("DIV0");
      const B_inv = norm(B.d, B.n);
      const raw = norm(A.n * B_inv.n, A.d * B_inv.d);
      result = raw;

      if (lang === "PL"){
        lines.push("KROK 2 ‚Äî DZIELENIE:");
        lines.push("Zasada: dzielenie przez u≈Çamek = mno≈ºenie przez odwrotno≈õƒá.");
        lines.push(`B = ${fracToString(B)} ‚Üí odwrotno≈õƒá(B) = ${fracToString(B_inv)} (zamieniamy miejscami licznik i mianownik)`);
        lines.push("Teraz liczymy jak zwyk≈Çe mno≈ºenie:");
        lines.push(`${fracToString(A)} √∑ ${fracToString(B)} = ${fracToString(A)} √ó ${fracToString(B_inv)}`);
        lines.push(`= (${A.n}√ó${B_inv.n})/(${A.d}√ó${B_inv.d})`);
        lines.push(`= ${A.n * B_inv.n}/${A.d * B_inv.d} = ${fracToString(raw)}`);
        NL();
        lines.push("WYNIK:");
        lines.push(`U≈Çamek: ${fracToString(result)}`);
        lines.push(`Mieszana: ${toMixed(result)}`);
      } else if (lang === "EN"){
        lines.push("STEP 2 ‚Äî DIVIDE:");
        lines.push("Rule: dividing by a fraction = multiplying by its reciprocal.");
        lines.push(`B = ${fracToString(B)} ‚Üí reciprocal(B) = ${fracToString(B_inv)} (swap top and bottom)`);
        lines.push("Now do normal multiplication:");
        lines.push(`${fracToString(A)} √∑ ${fracToString(B)} = ${fracToString(A)} √ó ${fracToString(B_inv)}`);
        lines.push(`= (${A.n}√ó${B_inv.n})/(${A.d}√ó${B_inv.d})`);
        lines.push(`= ${A.n * B_inv.n}/${A.d * B_inv.d} = ${fracToString(raw)}`);
        NL();
        lines.push("RESULT:");
        lines.push(`Fraction: ${fracToString(result)}`);
        lines.push(`Mixed: ${toMixed(result)}`);
      } else {
        lines.push("SCHRITT 2 ‚Äî DIVISION:");
        lines.push("Regel: durch einen Bruch teilen = mit dem Kehrwert multiplizieren.");
        lines.push(`B = ${fracToString(B)} ‚Üí Kehrwert(B) = ${fracToString(B_inv)} (oben/unten tauschen)`);
        lines.push("Jetzt normal multiplizieren:");
        lines.push(`${fracToString(A)} √∑ ${fracToString(B)} = ${fracToString(A)} √ó ${fracToString(B_inv)}`);
        lines.push(`= (${A.n}√ó${B_inv.n})/(${A.d}√ó${B_inv.d})`);
        lines.push(`= ${A.n * B_inv.n}/${A.d * B_inv.d} = ${fracToString(raw)}`);
        NL();
        lines.push("ERGEBNIS:");
        lines.push(`Bruch: ${fracToString(result)}`);
        lines.push(`Gemischt: ${toMixed(result)}`);
      }
    }

    return { result, steps: lines.join("\n"), A, B };
  }

  // ================== UI wiring ==================
  function showToast(msg){
    toast.textContent = msg;
    toast.style.display = "block";
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.style.display = "none", 2400);
  }

  function applyLang(lang){
    const tt = T[lang];
    $("title").textContent = tt.title;
    $("subtitle").textContent = tt.subtitle;
    $("langLabel").textContent = tt.langLabel;
    $("calcHeader").textContent = tt.calcHeader;
    $("examples").textContent = tt.examples;
    $("aLabel").textContent = tt.aLabel;
    $("bLabel").textContent = tt.bLabel;
    $("opLabel").textContent = tt.opLabel;
    calcBtn.textContent = tt.calcBtn;
    fillBtn.textContent = tt.fillBtn;
    $("hint").textContent = tt.hint;
    $("resFracLabel").textContent = tt.resFrac;
    $("resMixLabel").textContent = tt.resMix;
    $("helpHeader").textContent = tt.helpHeader;
    $("helpMini").textContent = tt.helpMini;

    // Update help cards
    const helpCards = $("helpCards");
    helpCards.innerHTML = `
      <div class="help-card">
        <h3>${tt.helpCards.add.title}</h3>
        <p>${tt.helpCards.add.desc}</p>
        <div style="margin-top:8px;">
          <code style="font-size:11px; color:var(--accent2)">${tt.helpCards.add.example}</code>
        </div>
      </div>

      <div class="help-card">
        <h3>${tt.helpCards.sub.title}</h3>
        <p>${tt.helpCards.sub.desc}</p>
        <div style="margin-top:8px;">
          <code style="font-size:11px; color:var(--accent2)">${tt.helpCards.sub.example}</code>
        </div>
      </div>

      <div class="help-card">
        <h3>${tt.helpCards.mul.title}</h3>
        <p>${tt.helpCards.mul.desc}</p>
        <div style="margin-top:8px;">
          <code style="font-size:11px; color:var(--accent2)">${tt.helpCards.mul.example}</code>
        </div>
      </div>

      <div class="help-card">
        <h3>${tt.helpCards.div.title}</h3>
        <p>${tt.helpCards.div.desc}</p>
        <div style="margin-top:8px;">
          <code style="font-size:11px; color:var(--accent2)">${tt.helpCards.div.example}</code>
        </div>
      </div>
    `;

    // Update help tip
    const helpTip = $("helpTip");
    if (lang === "PL") {
      helpTip.innerHTML = 'üí° <b>Wskaz√≥wka:</b> Naci≈õnij <span class="kbd">Enter</span> ≈ºeby policzyƒá.';
    } else if (lang === "EN") {
      helpTip.innerHTML = 'üí° <b>Tip:</b> Press <span class="kbd">Enter</span> to calculate.';
    } else if (lang === "DE") {
      helpTip.innerHTML = 'üí° <b>Tipp:</b> <span class="kbd">Enter</span> dr√ºcken zum Rechnen.';
    } else if (lang === "TR") {
      helpTip.innerHTML = 'üí° <b>ƒ∞pucu:</b> Hesaplamak i√ßin <span class="kbd">Enter</span> tu≈üuna basƒ±n.';
    } else if (lang === "RU") {
      helpTip.innerHTML = 'üí° <b>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</b> –ù–∞–∂–º–∏—Ç–µ <span class="kbd">Enter</span> –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è.';
    }

    if (stepsEl.textContent.trim() === "" || 
        stepsEl.textContent.includes("Tu pojawi") || 
        stepsEl.textContent.includes("detailed") || 
        stepsEl.textContent.includes("Hier erscheint") ||
        stepsEl.textContent.includes("Burada") ||
        stepsEl.textContent.includes("–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è")){
      stepsEl.textContent = tt.stepsDefault;
    }
  }

  function calc(){
    const lang = langSelect.value;
    const tt = T[lang];
    const A = aInput.value.trim();
    const B = bInput.value.trim();
    const op = opSelect.value;

    if (!A || !B){
      showToast(tt.errEmpty);
      return;
    }

    try{
      const { result, steps, A: fracA, B: fracB } = explain(lang, A, op, B);
      resFracEl.textContent = `${result.n}/${result.d}`;
      resMixEl.textContent = toMixed(result);
      stepsEl.textContent = steps;
      
      createVisuals(fracA, fracB, op, result, lang);
    }catch(e){
      visualSection.style.display = 'none';
      if (String(e.message).includes("DIV0")){
        showToast(tt.errDiv0);
      } else {
        showToast(tt.errFormat);
      }
    }
  }

  function fillExample(){
    const lang = langSelect.value;
    const examples = [
      ["1/2", "+", "1/3"],
      ["2 1/3", "+", "1/6"],
      ["5", "-", "2 3/4"],
      ["3/5", "*", "10/9"],
      ["2 1/2", "/", "3/4"]
    ];
    const pick = examples[Math.floor(Math.random()*examples.length)];
    aInput.value = pick[0];
    opSelect.value = pick[1];
    bInput.value = pick[2];
    stepsEl.textContent = T[lang].stepsDefault;
    resFracEl.textContent = "‚Äî";
    resMixEl.textContent = "‚Äî";
    visualSection.style.display = 'none';
  }

  themeBtn.addEventListener("click", ()=>{
    const b = document.body;
    b.dataset.theme = b.dataset.theme === "dark" ? "light" : "dark";
  });

  langSelect.addEventListener("change", () => {
    applyLang(langSelect.value);
    // Recalculate if there are results
    if (resFracEl.textContent !== "‚Äî") {
      calc();
    }
  });
  calcBtn.addEventListener("click", calc);
  fillBtn.addEventListener("click", fillExample);

  document.addEventListener("keydown", (e)=>{
    if (e.key === "Enter") calc();
  });
  
  // Prevent double-tap zoom on iOS
  let lastTouchEnd = 0;
  document.addEventListener('touchend', (e) => {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) {
      e.preventDefault();
    }
    lastTouchEnd = now;
  }, false);

  // init
  aInput.value = "1/2";
  bInput.value = "1/3";
  applyLang("PL");
  stepsEl.textContent = T.PL.stepsDefault;
</script>
</body>
</html>